<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Markets</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <ion-item lines="none">
    <ion-label>
      <h2>Verfügbar</h2>
      <p>{{ cryptoCount }} Kryptos • {{ stockCount }} Aktien</p>
    </ion-label>
  </ion-item>

  <!-- Banner (kurz) -->
  <ion-note color="medium" class="ion-margin-bottom">
    Nur aktuell synchronisierte Kryptowährungen werden angezeigt. Aktien und
    nicht synchronisierte Assets sind vorübergehend ausgeblendet.
  </ion-note>

  <!-- Info-Hinweis (mittel) + Tooltip -->
  <ion-item lines="none" class="ion-margin-bottom">
    <ion-label>
      In dieser Ansicht zeigen wir ausschließlich Kryptowährungen, die wir über
      unseren eigenen Datenimport (z. B. Binance) heruntergeladen und zuletzt
      aktualisiert haben. Einige Symbole können fehlen. Wir erweitern die
      Abdeckung laufend.
    </ion-label>
    <ion-button fill="clear" slot="end" id="info-tip">
      <ion-icon name="information-circle-outline"></ion-icon>
    </ion-button>
  </ion-item>
  <ion-popover trigger="info-tip" triggerAction="click">
    <ng-template>
      <ion-content class="ion-padding"
        >Zeigt nur intern synchronisierte Kryptowerte.</ion-content
      >
    </ng-template>
  </ion-popover>

  <ion-segment
    [(ngModel)]="selectedType"
    (ionChange)="onTypeFilterChange()"
    class="ion-margin-vertical"
  >
    <ion-segment-button value="all">Alle</ion-segment-button>
    <ion-segment-button value="crypto">Krypto</ion-segment-button>
    <ion-segment-button value="stock">Aktien</ion-segment-button>
  </ion-segment>

  <ion-item>
    <ion-label position="floating">Suche</ion-label>
    <ion-input
      [(ngModel)]="searchTerm"
      (ionChange)="onSearchChange()"
    ></ion-input>
  </ion-item>

  <ion-item lines="none" class="ion-margin-top">
    <ion-label>Sortieren nach</ion-label>
    <ion-segment (ionChange)="applyFilters()">
      <ion-segment-button value="nameAsc" (click)="sortBy='name'; sortDir='asc'"
        >Name ↑</ion-segment-button
      >
      <ion-segment-button
        value="nameDesc"
        (click)="sortBy='name'; sortDir='desc'"
        >Name ↓</ion-segment-button
      >
      <ion-segment-button
        value="priceAsc"
        (click)="sortBy='price'; sortDir='asc'"
        >Preis ↑</ion-segment-button
      >
      <ion-segment-button
        value="priceDesc"
        (click)="sortBy='price'; sortDir='desc'"
        >Preis ↓</ion-segment-button
      >
    </ion-segment>
  </ion-item>

  <ion-list class="list-tight">
    <ion-item *ngFor="let asset of filteredAssets" (click)="goToDetail(asset)">
      <ion-label>
        <h3>{{ asset.name }}</h3>
        <p>{{ asset.symbol }}</p>
      </ion-label>
      <ion-badge slot="end"
        >{{ latestPrices[asset.symbol] | number:'1.2-2' }}</ion-badge
      >
    </ion-item>
  </ion-list>

  <!-- Optional detailliert (Modal/FAQ) -->
  <ion-button expand="block" fill="outline" id="faq-open" class="ion-margin-top"
    >Mehr Infos</ion-button
  >
  <ion-modal trigger="faq-open">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Datenabdeckung</ion-title>
          <ion-buttons slot="end">
            <ion-button class="ion-padding-horizontal" (click)="(false)"
              >Schließen</ion-button
            >
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        Wir beschränken die Anzeige aktuell auf Kryptowährungen, die wir selbst
        in regelmäßigen Abständen abrufen und speichern. Dadurch stellen wir
        schnellere und stabilere Kursdaten bereit. Nicht synchronisierte Assets
        werden ausgeblendet, bis sie in unseren Datenbestand aufgenommen sind.
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
